## Mikä? Kotitehtävä palvelinten hallinta -kurssille.

Vagrantin ajo Windowsilla Lenovo IdeaPad 1 14" R5-7520U:lla läppärillä.

### Kotitehtävä 3: puolikas

a) Puolikas. Tee ensimmäinen vedos omasta modulista. Tätä jatketaan vielä, eli valmista ei tarvitse tulla. Keskeneräisen modulin pohjalta saat vinkkejä haastaviin kohtiin ja oikeaan kehityssuuntaan. Lopullisen modulin tulee olla modernia keskitettyä hallintaa, eli idempotentti ja infraa koodina.

Omaksi moduuliksi ajattelin tehdä työpöydän. Verkkosivulle apachella valokuvagallerian, jonne voin laittaa ottamiani valokuvia. Lisäksi discordin, jossa voin jakaa valokuvia kavereilleni sekä Gimpin, jolla voin muokata valokuvia.


Ideana olisi tehdä yksi master kone ja kaksi/kolme minionia. Ekalle minionille valokuvagalleria apachen kautta, toiseen minioniin työasema, jonne Discord ja Gimp sekä ehkä kolmanteen minioniin tiedostopalvelin tiedostojen jakamista varten. Aloitan siis tekemälla masterin ja kaksi minionia. 

```ruby
# -*- mode: ruby -*-
# vi: set ft=ruby :
# Copyright 2019-2021 Tero Karvinen http://TeroKarvinen.com

$tscript = <<TSCRIPT
set -o verbose
apt-get update
apt-get -y install tree
echo "Done - set up test environment - https://terokarvinen.com/search/?q=vagrant"
TSCRIPT

Vagrant.configure("2") do |config|
	config.vm.synced_folder ".", "/vagrant", disabled: true
	config.vm.synced_folder "shared/", "/home/vagrant/shared", create: true
	config.vm.provision "shell", inline: $tscript
	config.vm.box = "debian/bookworm64"

	# Master -kone
	config.vm.define "master" do |master|
		master.vm.hostname = "master"
		master.vm.network "private_network", ip: "192.168.88.101"
	end

	# Minion 1: Apache webpalvelin -kone 
	config.vm.define "minion1" do |minion1|
		minion1.vm.hostname = "minion1"
		minion1.vm.network "private_network", ip: "192.168.88.102"
	end

	# Minion 2: Tiedostopalvelin -kone 
	config.vm.define "minion2" do |minion2|
		minion2.vm.hostname = "minion2"
		minion2.vm.network "private_network", ip: "192.168.88.103"
	end
end
```

![image](https://github.com/user-attachments/assets/40663ee9-6765-4a41-bd36-212f0605ad3d)

Virtuaalikoneet ladattu. 


![image](https://github.com/user-attachments/assets/75e37424-0f69-4792-b4dd-e174d912c4eb)

kuva pingttu masterilta minioneita


sitten masterille salt-masterin lataus.

komennot, kansio avaimille

```
sudo apt-get update
sudo apt install curl
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://packages.broadcom.com/artifactory/api/security/keypair/SaltProjectKey/public | sudo tee /etc/apt/keyrings/salt-archive-keyring.pgp
curl -fsSL https://github.com/saltstack/salt-install-guide/releases/latest/download/salt.sources | sudo tee /etc/apt/sources.list.d/salt.sources
sudo apt-get update
sudo apt install salt-master
sudo systemctl enable salt-master
sudo systemctl start salt-master
```

![image](https://github.com/user-attachments/assets/7acf612a-87c7-4051-b49b-c33f9aaae7f7)
kuva onnistunut lataus


![image](https://github.com/user-attachments/assets/0393b7d1-11cd-49bb-8441-d8c319e15385)

kuva. salt master status


tein skriptin, jolla lataan minionit

```bash
#!/bin/bash

sudo apt-get update
sudo apt install -y curl
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://packages.broadcom.com/artifactory/api/security/keypair/SaltProjectKey/public | sudo tee /etc/apt/keyrings/salt-archive-keyring.pgp
curl -fsSL https://github.com/saltstack/salt-install-guide/releases/latest/download/salt.sources | sudo tee /etc/apt/sources.list.d/salt.sources
sudo apt-get update
sudo apt install -y salt-minion
sudo systemctl enable salt-minion
sudo systemctl start salt-minion
sudo systemctl status salt-minion

```

```
nano minion.sh
chmod +x minion.sh
./minion.sh
```

sitten 

lataus onnistui skriptin kautta, mutta ei saanut yhteyttä vielä masteriin

![image](https://github.com/user-attachments/assets/dfcf3a06-45a4-487c-8b8e-aab9171184b3)


joten /Etc/salt/minion tiedostoon masterin ip 192.168.88.101
sudoeditillä ja restart

```
sudoedit /etc/salt/minion
master: 192.168.88.101
sudo systemctl restart salt-minion
```

tässä välissä meen minion2 ja lataan sinne salt-minionin ja hyväksyn avaimet vasta samaan aikaan. käytän samaa skriptiä kuin äskön

```
exit
vagrant ssh minion2
nano minion.sh
chmod +x minion.sh
./minion.sh
sudoedit /etc/salt/minion
master: 192.168.88.101
sudo systemctl restart salt-minion
exit
```

sitten avainten hyväksymiset

![image](https://github.com/user-attachments/assets/3882ab93-c2f3-42f6-bafb-d07ae7227bc0)

kuva avainten hyväksymiset

tehdään vielä testipingit

![image](https://github.com/user-attachments/assets/8a1c69fd-f3c3-48c4-b721-01cb80fdf9a7)
kuva koneet yhteydessä toisiinsa





